{"version":3,"sources":["demo/util.js","demo/image/sky.jpg","demo/image/circle.gif","demo/Demo10.js"],"names":["__webpack_require__","d","__webpack_exports__","glsl","loadImageList","getPosition","createVertexList","createRotateZMatrix","createTranslateMatrix","createScaleMatrix","x","loadImage","src","Promise","resolve","reject","image","Image","onload","onerror","error","list","arguments","length","undefined","all","map","getX","rect","clientX","left","width","getY","clientY","height","top","canvas","event","getBoundingClientRect","Float32Array","flat","Infinity","createMatrix","sourceList","data","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","array","value","push","err","return","radian","Math","PI","sinB","sin","cosB","cos","y","z","scaleX","scaleY","scaleZ","module","exports","p","Demo02","ref","useRef","useEffect","gl","current","getContext","angle","makeItem","then","_ref","Object","D_Users_Jade_Documents_code_github_learn_webgl_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_4__","D_Users_Jade_Documents_code_github_learn_webgl_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_3___default","a","mark","_callee2","item","render","wrap","_context2","prev","_ref2","_callee","axis","props","_context","vec3","fromValues","clearColor","clear","COLOR_BUFFER_BIT","requestAnimationFrame","stop","apply","this","_x","react__WEBPACK_IMPORTED_MODULE_5___default","createElement","_ref3","_callee4","VSHADER_SOURCE","FSHADER_SOURCE","program","location","vertexList","FSIZE","buffer","imageSrcList","_ref4","_ref5","skyImage","circleImage","useProgram","useTexture","draw","identityM","rotateM","rotate","_context4","_templateObject","_templateObject2","makeProgram","vertex","fragment","makeLocation","attribute","uniform","BYTES_PER_ELEMENT","attachBuffer","type","ARRAY_BUFFER","enableAttribute","aPosition","size","stride","offset","aTexCoor","skyImageSrc","circleImageSrc","sent","D_Users_Jade_Documents_code_github_learn_webgl_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","bindBuffer","attachTexture2D","unit","uSampler0","source","format","RGBA","UNSIGNED_BYTE","parameters","name","TEXTURE_MIN_FILTER","LINEAR","uSampler1","drawArrays","TRIANGLE_STRIP","mat4","create","_ref6","_callee3","_context3","uniformMatrix4fv","uRotateM","_x3","_x4","abrupt","_x2","vshader","createShader","VERTEX_SHADER","fshader","FRAGMENT_SHADER","createProgram","shader","attachShader","linkProgram","message","getProgramInfoLog","Error","_ref7","shaderSource","compileShader","getShaderInfoLog","_ref8","_ref8$usage","usage","STATIC_DRAW","createBuffer","bufferData","_ref9","_ref9$type","FLOAT","_ref9$normalized","normalized","vertexAttribPointer","enableVertexAttribArray","mapKeyListToObj","f","reduce","obj","index","_ref10","D_Users_Jade_Documents_code_github_learn_webgl_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","nameList","getAttribLocation","makeAttributeLocation","getUniformLocation","makeUniformLocation","_ref11","_ref11$flipY","flipY","_ref11$parameters","texture","createTexture","pixelStorei","UNPACK_FLIP_Y_WEBGL","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","forEach","_ref12","texParameteri","level","texImage2D","uniform1i"],"mappings":"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","file":"static/js/7.d44c4318.chunk.js","sourcesContent":["export const glsl = x => x\r\n\r\nexport const loadImage = src => {\r\n  return new Promise((resolve, reject) => {\r\n    let image = new Image()\r\n    image.onload = () => resolve(image)\r\n    image.onerror = error => reject(error)\r\n    image.src = src\r\n  })\r\n}\r\n\r\nexport const loadImageList = (list = []) => {\r\n  return Promise.all(list.map(loadImage))\r\n}\r\n\r\nexport const getX = (rect, clientX) => {\r\n  return (clientX - rect.left - rect.width / 2) / (rect.width / 2)\r\n}\r\n\r\nexport const getY = (rect, clientY) => {\r\n  return (rect.height / 2 - (clientY - rect.top)) / (rect.height / 2)\r\n}\r\n\r\nexport const getPosition = (canvas, event) => {\r\n  let rect = canvas.getBoundingClientRect()\r\n  return [getX(rect, event.clientX), getY(rect, event.clientY)]\r\n}\r\n\r\nexport const createVertexList = (list = []) => {\r\n  return new Float32Array(list.flat(Infinity))\r\n}\r\n\r\n/**\r\n * [\r\n *    [1, 2, 3, 4],\r\n *    [5, 6, 7, 8],\r\n *    [9, 10, 11, 12],\r\n *    [13, 14, 15, 16]\r\n * ]\r\n */\r\nexport const createMatrix = sourceList => {\r\n  let data = [[], [], [], []]\r\n\r\n  for (let array of sourceList) {\r\n    data[0].push(array[0])\r\n    data[1].push(array[1])\r\n    data[2].push(array[2])\r\n    data[3].push(array[3])\r\n  }\r\n\r\n  return new Float32Array(data.flat())\r\n}\r\n\r\nexport const createRotateZMatrix = (angle = 0) => {\r\n  let radian = (angle * Math.PI) / 180\r\n  let sinB = Math.sin(radian)\r\n  let cosB = Math.cos(radian)\r\n\r\n  return createMatrix([\r\n    [cosB, -sinB, 0.0, 0.0],\r\n    [sinB, cosB, 0.0, 0.0],\r\n    [0.0, 0.0, 1.0, 0.0],\r\n    [0.0, 0.0, 0.0, 1.0]\r\n  ])\r\n}\r\n\r\nexport const createTranslateMatrix = (x = 0, y = 0, z = 0) => {\r\n  return createMatrix([\r\n    [1.0, 0.0, 0.0, x],\r\n    [0.0, 1.0, 0.0, y],\r\n    [0.0, 0.0, 1.0, z],\r\n    [0.0, 0.0, 0.0, 1.0]\r\n  ])\r\n}\r\n\r\nexport const createScaleMatrix = (scaleX = 1, scaleY = 1, scaleZ = 1) => {\r\n  return createMatrix([\r\n    [scaleX, 0.0, 0.0, 0],\r\n    [0, scaleY, 0, 0],\r\n    [0, 0, scaleZ, 0],\r\n    [0, 0, 0, 1]\r\n  ])\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/sky.2b11efd6.jpg\";","module.exports = __webpack_public_path__ + \"static/media/circle.def06678.gif\";","import React, { useEffect, useRef } from 'react'\r\nimport { mat4, vec3 } from 'gl-matrix'\r\nimport { loadImageList, glsl, createVertexList } from './util'\r\nimport skyImageSrc from './image/sky.jpg'\r\nimport circleImageSrc from './image/circle.gif'\r\n\r\nexport default function Demo02() {\r\n  let ref = useRef()\r\n\r\n  useEffect(() => {\r\n    let canvas = ref.current\r\n    let gl = canvas.getContext('webgl')\r\n    let angle = 0\r\n    makeItem(gl).then(async item => {\r\n      let render = async () => {\r\n        let radian = ((angle % 360) * Math.PI) / 180\r\n        let axis = vec3.fromValues(0, 0, 1)\r\n        let props = {\r\n          radian,\r\n          axis\r\n        }\r\n\r\n        gl.clearColor(0, 0, 0, 1)\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n\r\n        item.render(props)\r\n\r\n        angle += 1\r\n        requestAnimationFrame(render)\r\n      }\r\n\r\n      render()\r\n    })\r\n  }, [])\r\n\r\n  return <canvas width={400} height={400} ref={ref} />\r\n}\r\n\r\nconst makeItem = async gl => {\r\n  let VSHADER_SOURCE = glsl`\r\n    attribute vec4 aPosition;\r\n    attribute vec2 aTexCoor;\r\n    uniform mat4 uRotateM;\r\n    varying vec2 vTexCoor;\r\n    void main() {\r\n      gl_Position = uRotateM * aPosition;\r\n      vTexCoor = aTexCoor;\r\n    }\r\n  `\r\n\r\n  let FSHADER_SOURCE = glsl`\r\n    precision mediump float;\r\n    varying vec2 vTexCoor;\r\n    uniform sampler2D uSampler0;\r\n    uniform sampler2D uSampler1;\r\n    void main() {\r\n      vec4 color0 = texture2D(uSampler0, vTexCoor);\r\n      vec4 color1 = texture2D(uSampler1, vTexCoor);\r\n      gl_FragColor = color0 * color1;\r\n    }\r\n  `\r\n\r\n  let program = makeProgram(gl, {\r\n    vertex: VSHADER_SOURCE,\r\n    fragment: FSHADER_SOURCE\r\n  })\r\n\r\n  let location = makeLocation(gl, {\r\n    program,\r\n    attribute: ['aPosition', 'aTexCoor'],\r\n    uniform: ['uSampler0', 'uSampler1', 'uRotateM']\r\n  })\r\n\r\n  let vertexList = createVertexList([\r\n    [[-0.5, 0.5], [0.0, 1.0]],\r\n    [[-0.5, -0.5], [0.0, 0.0]],\r\n    [[0.5, 0.5], [1.0, 1.0]],\r\n    [[0.5, -0.5], [1.0, 0.0]]\r\n  ])\r\n\r\n  let FSIZE = vertexList.BYTES_PER_ELEMENT\r\n\r\n  let buffer = attachBuffer(gl, {\r\n    type: gl.ARRAY_BUFFER,\r\n    data: vertexList\r\n  })\r\n\r\n  enableAttribute(gl, {\r\n    location: location.aPosition,\r\n    size: 2,\r\n    stride: FSIZE * 4,\r\n    offset: 0\r\n  })\r\n\r\n  enableAttribute(gl, {\r\n    location: location.aTexCoor,\r\n    size: 2,\r\n    stride: FSIZE * 4,\r\n    offset: FSIZE * 2\r\n  })\r\n\r\n  let imageSrcList = [skyImageSrc, circleImageSrc]\r\n  let [skyImage, circleImage] = await loadImageList(imageSrcList)\r\n\r\n  let useProgram = () => {\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer)\r\n    gl.useProgram(program)\r\n  }\r\n\r\n  let useTexture = () => {\r\n    attachTexture2D(gl, {\r\n      unit: 0,\r\n      location: location.uSampler0,\r\n      image: {\r\n        source: skyImage,\r\n        format: gl.RGBA,\r\n        type: gl.UNSIGNED_BYTE\r\n      },\r\n      parameters: [\r\n        {\r\n          name: gl.TEXTURE_MIN_FILTER,\r\n          value: gl.LINEAR\r\n        }\r\n      ]\r\n    })\r\n\r\n    attachTexture2D(gl, {\r\n      unit: 1,\r\n      location: location.uSampler1,\r\n      image: {\r\n        source: circleImage,\r\n        format: gl.RGBA,\r\n        type: gl.UNSIGNED_BYTE\r\n      },\r\n      parameters: [\r\n        {\r\n          name: gl.TEXTURE_MIN_FILTER,\r\n          value: gl.LINEAR\r\n        }\r\n      ]\r\n    })\r\n  }\r\n\r\n  let draw = () => {\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4)\r\n  }\r\n\r\n  let identityM = mat4.create()\r\n  let rotateM = mat4.create()\r\n  let rotate = async (radian, axis) => {\r\n    mat4.rotate(rotateM, identityM, radian, axis)\r\n    gl.uniformMatrix4fv(location.uRotateM, false, rotateM)\r\n  }\r\n\r\n  let render = props => {\r\n    useProgram()\r\n    useTexture()\r\n    rotate(props.radian, props.axis)\r\n    draw()\r\n  }\r\n\r\n  return { render }\r\n}\r\n\r\nconst makeProgram = (gl, source) => {\r\n  let vshader = createShader(gl, {\r\n    type: gl.VERTEX_SHADER,\r\n    source: source.vertex\r\n  })\r\n  let fshader = createShader(gl, {\r\n    type: gl.FRAGMENT_SHADER,\r\n    source: source.fragment\r\n  })\r\n  let program = createProgram(gl, {\r\n    vertex: vshader,\r\n    fragment: fshader\r\n  })\r\n\r\n  return program\r\n}\r\n\r\nconst createProgram = (gl, shader) => {\r\n  let program = gl.createProgram()\r\n\r\n  gl.attachShader(program, shader.vertex)\r\n  gl.attachShader(program, shader.fragment)\r\n  gl.linkProgram(program)\r\n\r\n  let message = gl.getProgramInfoLog(program)\r\n  if (message) throw new Error(message)\r\n  return program\r\n}\r\n\r\nconst createShader = (gl, { type, source }) => {\r\n  let shader = gl.createShader(type)\r\n\r\n  gl.shaderSource(shader, source)\r\n  gl.compileShader(shader)\r\n\r\n  let message = gl.getShaderInfoLog(shader)\r\n  if (message) throw new Error(message)\r\n  return shader\r\n}\r\n\r\nconst attachBuffer = (gl, { type, data, usage = gl.STATIC_DRAW }) => {\r\n  let buffer = gl.createBuffer()\r\n  gl.bindBuffer(type, buffer)\r\n  gl.bufferData(type, data, usage)\r\n  return buffer\r\n}\r\n\r\nconst enableAttribute = (\r\n  gl,\r\n  { location, size, type = gl.FLOAT, normalized = false, stride, offset }\r\n) => {\r\n  gl.vertexAttribPointer(location, size, type, normalized, stride, offset)\r\n  gl.enableVertexAttribArray(location)\r\n}\r\n\r\nconst mapKeyListToObj = (list, f) =>\r\n  list.reduce((obj, name, index) => {\r\n    obj[name] = f(name, index)\r\n    return obj\r\n  }, {})\r\n\r\nconst makeAttributeLocation = (gl, program, nameList = []) =>\r\n  mapKeyListToObj(nameList, name => gl.getAttribLocation(program, name))\r\n\r\nconst makeUniformLocation = (gl, program, nameList = []) =>\r\n  mapKeyListToObj(nameList, name => gl.getUniformLocation(program, name))\r\n\r\nconst makeLocation = (gl, { program, attribute, uniform }) => ({\r\n  ...makeAttributeLocation(gl, program, attribute),\r\n  ...makeUniformLocation(gl, program, uniform)\r\n})\r\n\r\nconst attachTexture2D = (\r\n  gl,\r\n  { location, unit, image, flipY = true, parameters = [] }\r\n) => {\r\n  let texture = gl.createTexture()\r\n\r\n  if (flipY) gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1)\r\n\r\n  gl.activeTexture(gl.TEXTURE0 + unit)\r\n  gl.bindTexture(gl.TEXTURE_2D, texture)\r\n\r\n  parameters.forEach(({ name, value }) => {\r\n    gl.texParameteri(gl.TEXTURE_2D, name, value)\r\n  })\r\n\r\n  image = {\r\n    level: 0,\r\n    format: gl.RGBA,\r\n    type: gl.UNSIGNED_BYTE,\r\n    ...image\r\n  }\r\n\r\n  gl.texImage2D(\r\n    gl.TEXTURE_2D,\r\n    image.level,\r\n    image.format,\r\n    image.format,\r\n    image.type,\r\n    image.source\r\n  )\r\n\r\n  gl.uniform1i(location, unit)\r\n\r\n  return texture\r\n}\r\n"],"sourceRoot":""}
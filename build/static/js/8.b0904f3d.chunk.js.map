{"version":3,"sources":["../node_modules/_@babel_runtime@7.3.1@@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/_@babel_runtime@7.3.1@@babel/runtime/helpers/esm/createClass.js","lib/runtime.js","demo/ray-tracing.js","demo/Demo12.js"],"names":["_classCallCheck","instance","Constructor","TypeError","__webpack_require__","d","__webpack_exports__","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","vec3","require","isVec3","obj","Float32Array","toVec3","n","fromValues","module","exports","_add_","left","right","add","create","_sub_","sub","_mul_","mul","_div_","div","_negate_","operand","negate","from","x","y","z","dot","vec3a","vec3b","cross","normalize","Ray","a","b","classCallCheck","this","t","createRecord","p","normal","Sphere","center","radius","material","ray","tmin","tmax","record","oc","origin","direction","c","discriminant","temp","Math","sqrt","isValid","pointAt","HitableList","list","tempRecord","hited","closest","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","value","hit","assign","err","return","_this$list","push","apply","arguments","Camera","lookFrom","lookAt","vup","vfov","aspect","aperture","focusDist","theta","PI","halfHeight","tan","halfWidth","w","u","v","lowerLeftCorner","horizontal","vertical","lensRadius","s","rd","randomVec3","random","randomInUnitDisk","offset","randomInUnitSphere","squaredLength","LambertianMaterial","albedo","ref","scattered","attenuation","reflect","MetalMaterial","fuzz","min","reflected","DielectricMaterial","refractIndex","outwardNormal","ni_over_nt","consine","dotResult","refractProb","uv","dt","refracted","refract","r0","pow","schlick","color","world","depth","Infinity","scatter","start","end","ray_tracing","_ref","_ref$width","width","_ref$height","height","_ref$amount","amount","_ref$lookFrom","_ref$lookAt","_ref$vup","_ref$vfov","_ref$aspect","_ref$focusDist","_ref$aperture","nx","ny","camera","range","floor","based","chooseMat","randomScene","regenerator_default","mark","_callee","j","_color","_color2","r","g","wrap","_context","prev","getRay","slicedToArray","stop","delay","time","Promise","resolve","setTimeout","Demo01","_useState","useState","_useState2","count","setCount","_useState3","_useState4","setTime","useRef","useEffect","ctx","current","getContext","imageData","createImageData","renderImage","createRayTracing","data","innerCount","innerTime","tid","over","render","asyncToGenerator","duration","Date","now","abrupt","t0","finish","clearRect","putImageData","clearTimeout","_react_16_8_6_react_default","createElement","Fragment","toFixed"],"mappings":"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","file":"static/js/8.b0904f3d.chunk.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","const { vec3 } = require('gl-matrix')\r\n\r\nconst isVec3 = obj => obj instanceof Float32Array\r\nconst toVec3 = n => vec3.fromValues(n, n, n)\r\n\r\nlet _add_ = function(left, right) {\r\n  if (!isVec3(left) && !isVec3(right)) return left + right\r\n\r\n  if (!isVec3(left)) left = toVec3(left)\r\n  if (!isVec3(right)) right = toVec3(right)\r\n\r\n  return vec3.add(vec3.create(), left, right)\r\n}\r\n\r\nlet _sub_ = function(left, right) {\r\n  if (!isVec3(left) && !isVec3(right)) return left - right\r\n\r\n  if (!isVec3(left)) left = toVec3(left)\r\n  if (!isVec3(right)) right = toVec3(right)\r\n\r\n  return vec3.sub(vec3.create(), left, right)\r\n}\r\n\r\nlet _mul_ = function(left, right) {\r\n  if (!isVec3(left) && !isVec3(right)) return left * right\r\n\r\n  if (!isVec3(left)) left = toVec3(left)\r\n  if (!isVec3(right)) right = toVec3(right)\r\n\r\n  return vec3.mul(vec3.create(), left, right)\r\n}\r\n\r\nlet _div_ = function(left, right) {\r\n  if (!isVec3(left) && !isVec3(right)) return left / right\r\n\r\n  if (!isVec3(left)) left = toVec3(left)\r\n  if (!isVec3(right)) right = toVec3(right)\r\n\r\n  return vec3.div(vec3.create(), left, right)\r\n}\r\n\r\nlet _negate_ = function(operand) {\r\n  if (!isVec3(operand)) return -operand\r\n  return vec3.negate(vec3.create(), operand)\r\n}\r\n\r\nmodule.exports = {\r\n  _add_,\r\n  _sub_,\r\n  _mul_,\r\n  _div_,\r\n  _negate_\r\n}\r\n","const {\n  vec3\n} = require('gl-matrix');\n\nconst {\n  _add_,\n  _sub_,\n  _mul_,\n  _div_,\n  _negate_\n} = require('../lib/runtime');\n\nconst from = (x, y, z) => vec3.fromValues(x, y, z);\n\nconst dot = (vec3a, vec3b) => vec3.dot(vec3a, vec3b);\n\nconst cross = (vec3a, vec3b) => vec3.cross(vec3.create(), vec3a, vec3b);\n\nconst normalize = vec3a => vec3.normalize(vec3.create(), vec3a);\n\nclass Ray {\n  constructor(a, b) {\n    this.a = a;\n    this.b = b;\n  }\n\n  origin() {\n    return this.a;\n  }\n\n  direction() {\n    return this.b;\n  }\n\n  pointAt(t) {\n    let {\n      a,\n      b\n    } = this;\n    return _add_(a, _mul_(t, b));\n  }\n\n} // linear-blend/linear-interpolation\n\n\nconst lerp = (t, start, end) => _add_(_mul_(_sub_(1.0, t), start), _mul_(t, end));\n\nconst createRecord = () => {\n  return {\n    t: 0,\n    p: vec3.create(),\n    normal: vec3.create()\n  };\n};\n\nclass Sphere {\n  constructor(center, radius, material) {\n    this.center = center;\n    this.radius = radius;\n    this.material = material;\n  }\n\n  hit(ray, tmin, tmax, record) {\n    let oc = _sub_(ray.origin(), this.center);\n\n    let a = dot(ray.direction(), ray.direction());\n    let b = dot(oc, ray.direction());\n\n    let c = _sub_(dot(oc, oc), _mul_(this.radius, this.radius));\n\n    let discriminant = _sub_(_mul_(b, b), _mul_(a, c));\n\n    if (discriminant < 0) return false;\n\n    let temp = _div_(_sub_(_negate_(b), Math.sqrt(discriminant)), a);\n\n    let isValid = temp < tmax && temp > tmin;\n\n    if (!isValid) {\n      temp = _div_(_add_(_negate_(b), Math.sqrt(discriminant)), a);\n      isValid = temp < tmax && temp > tmin;\n    }\n\n    if (isValid) {\n      record.t = temp;\n      record.p = ray.pointAt(temp);\n      record.normal = _div_(_sub_(record.p, this.center), this.radius);\n      record.material = this.material;\n      return true;\n    }\n\n    return false;\n  }\n\n}\n\nclass HitableList {\n  constructor(list) {\n    this.list = list;\n  }\n\n  hit(ray, tmin, tmax, record) {\n    let tempRecord = createRecord();\n    let hited = false;\n    let closest = tmax;\n\n    for (let object of this.list) {\n      if (object.hit(ray, tmin, closest, tempRecord)) {\n        hited = true;\n        closest = tempRecord.t;\n        Object.assign(record, tempRecord);\n      }\n    }\n\n    return hited;\n  }\n\n  push(...args) {\n    this.list.push(...args);\n  }\n\n}\n\nconst randomInUnitDisk = () => {\n  let p;\n\n  do {\n    let randomVec3 = from(Math.random(), Math.random(), 0.0);\n    p = _sub_(_mul_(2.0, randomVec3), from(1.0, 1.0, 0.0));\n  } while (dot(p, p) >= 1.0);\n\n  return p;\n};\n\nclass Camera {\n  constructor(lookFrom, lookAt, vup, vfov, aspect, aperture, focusDist) {\n    let theta = _div_(_mul_(vfov, Math.PI), 180);\n\n    let halfHeight = Math.tan(_div_(theta, 2));\n\n    let halfWidth = _mul_(halfHeight, aspect);\n\n    let origin = lookFrom;\n    let w = normalize(_sub_(lookFrom, lookAt));\n    let u = normalize(cross(vup, w));\n    let v = cross(w, u);\n\n    let lowerLeftCorner = _sub_(origin, _mul_(focusDist, _add_(_add_(_mul_(u, halfWidth), _mul_(v, halfHeight)), w)));\n\n    let horizontal = _mul_(_mul_(_mul_(focusDist, 2), u), halfWidth);\n\n    let vertical = _mul_(_mul_(_mul_(focusDist, 2), v), halfHeight);\n\n    this.u = u;\n    this.v = v;\n    this.origin = origin;\n    this.lowerLeftCorner = lowerLeftCorner;\n    this.horizontal = horizontal;\n    this.vertical = vertical;\n    this.lensRadius = _div_(aperture, 2);\n  }\n\n  getRay(s, t) {\n    let {\n      origin,\n      lowerLeftCorner,\n      horizontal,\n      vertical\n    } = this;\n\n    let rd = _mul_(this.lensRadius, randomInUnitDisk());\n\n    let offset = _add_(_mul_(this.u, rd[0]), _mul_(this.v, rd[1]));\n\n    let direction = _sub_(_add_(_add_(lowerLeftCorner, _mul_(s, horizontal)), _mul_(t, vertical)), origin);\n\n    let ray = new Ray(_add_(origin, offset), _sub_(direction, offset));\n    return ray;\n  }\n\n}\n\nconst randomInUnitSphere = () => {\n  let p;\n\n  do {\n    let randomVec3 = from(Math.random(), Math.random(), Math.random());\n    p = _sub_(_mul_(2.0, randomVec3), from(1.0, 1.0, 1.0));\n  } while (vec3.squaredLength(p) >= 1.0);\n\n  return p;\n};\n\nclass LambertianMaterial {\n  constructor(albedo) {\n    this.albedo = albedo;\n  }\n\n  scatter(ray, record, ref) {\n    let target = _add_(_add_(record.p, record.normal), randomInUnitSphere());\n\n    let direction = _sub_(target, record.p);\n\n    ref.scattered = new Ray(record.p, direction);\n    ref.attenuation = this.albedo;\n    return true;\n  }\n\n}\n\nconst reflect = (v, n) => {\n  return _sub_(v, _mul_(_mul_(2.0, dot(v, n)), n));\n};\n\nclass MetalMaterial {\n  constructor(albedo, fuzz = 1) {\n    this.albedo = albedo;\n    this.fuzz = Math.min(fuzz, 1);\n  }\n\n  scatter(ray, record, ref) {\n    let reflected = reflect(vec3.normalize(vec3.create(), ray.direction()), record.normal);\n    ref.scattered = new Ray(record.p, _add_(reflected, _mul_(this.fuzz, randomInUnitSphere())));\n    ref.attenuation = this.albedo;\n    return dot(ref.scattered.direction(), record.normal) > 0;\n  }\n\n}\n\nconst refract = (v, normal, ni_over_nt, ref) => {\n  let uv = vec3.normalize(vec3.create(), v);\n  let dt = dot(uv, normal);\n\n  let discriminant = _sub_(1.0, _mul_(_mul_(ni_over_nt, ni_over_nt), _sub_(1.0, _mul_(dt, dt))));\n\n  if (discriminant > 0) {\n    ref.refracted = _sub_(_mul_(ni_over_nt, _sub_(uv, _mul_(normal, dt))), _mul_(normal, Math.sqrt(discriminant)));\n    return true;\n  }\n\n  return false;\n};\n\nconst schlick = (consine, refractIndex) => {\n  let r0 = _div_(_sub_(1, refractIndex), _add_(1, refractIndex));\n\n  r0 = _mul_(r0, r0);\n  return _add_(r0, _mul_(_sub_(1, r0), Math.pow(_sub_(1, consine), 5)));\n};\n\nclass DielectricMaterial {\n  constructor(refractIndex) {\n    this.refractIndex = refractIndex;\n  }\n\n  scatter(ray, record, ref) {\n    let outwardNormal = vec3.create();\n    let reflected = reflect(ray.direction(), record.normal);\n    let ni_over_nt = 0.0;\n    let consine = 0.0;\n    ref.attenuation = from(1.0, 1.0, 1.0);\n    let dotResult = dot(ray.direction(), record.normal);\n\n    if (dotResult > 0) {\n      outwardNormal = _negate_(record.normal);\n      ni_over_nt = this.refractIndex;\n      consine = _div_(_mul_(this.refractIndex, dotResult), vec3.length(ray.direction()));\n    } else {\n      outwardNormal = record.normal;\n      ni_over_nt = _div_(1.0, this.refractIndex);\n      consine = _div_(_negate_(dotResult), vec3.length(ray.direction()));\n    }\n\n    let refractProb = 0.0;\n\n    if (refract(ray.direction(), outwardNormal, ni_over_nt, ref)) {\n      refractProb = schlick(consine, this.refractIndex);\n    } else {\n      refractProb = 1.0;\n    }\n\n    if (Math.random() < refractProb) {\n      ref.scattered = new Ray(record.p, reflected);\n    } else {\n      ref.scattered = new Ray(record.p, ref.refracted);\n    }\n\n    return true;\n  }\n\n}\n\nconst color = (ray, world, depth = 0) => {\n  let record = createRecord();\n\n  if (world.hit(ray, 0.001, Infinity, record)) {\n    let ref = {\n      scattered: null,\n      attenuation: 0\n    };\n\n    if (depth >= 50 || !record.material.scatter(ray, record, ref)) {\n      return from(0.0, 0.0, 0.0);\n    }\n\n    return _mul_(ref.attenuation, color(ref.scattered, world, _add_(depth, 1)));\n  }\n\n  let direction = vec3.normalize(vec3.create(), ray.direction());\n  return lerp(_mul_(0.5, _add_(direction[1], 1.0)), from(1.0, 1.0, 1.0), from(0.5, 0.7, 1.0));\n};\n\nconst randomScene = amount => {\n  let list = [];\n  let range = Math.floor(_div_(Math.sqrt(amount), 2));\n\n  let start = _negate_(range);\n\n  let end = +range;\n  list[0] = new Sphere(from(0.0, -1000, 0), 1000, new LambertianMaterial(from(0.5, 0.5, 0.5)));\n  let i = 1;\n  let based = from(4.0, 0.2, 0.0);\n\n  for (let a = start; a < end; a++) {\n    for (let b = start; b < end; b++) {\n      let chooseMat = Math.random();\n      let center = from(_add_(a, _mul_(0.9, Math.random())), 0.2, _add_(b, _mul_(0.9, Math.random())));\n\n      if (vec3.length(_sub_(center, based)) > 0.9) {\n        if (chooseMat < 0.8) {\n          let material = new LambertianMaterial(from(_mul_(Math.random(), Math.random()), _mul_(Math.random(), Math.random()), _mul_(Math.random(), Math.random())));\n          list[i++] = new Sphere(center, 0.2, material);\n        } else if (chooseMat < 0.95) {\n          let material = new MetalMaterial(from(_mul_(0.5, _add_(1, Math.random())), _mul_(0.5, _add_(1, Math.random())), _mul_(0.5, _add_(1, Math.random()))), _mul_(0.5, Math.random()));\n          list[i++] = new Sphere(center, 0.2, material);\n        } else {\n          list[i++] = new Sphere(center, 0.2, new DielectricMaterial(1.5));\n        }\n      }\n    }\n  }\n\n  list[i++] = new Sphere(from(0.0, 1.0, 0.0), 1.0, new DielectricMaterial(1.5));\n  list[i++] = new Sphere(from(-4.0, 1.0, 0.0), 1.0, new LambertianMaterial(from(0.4, 0.2, 0.1)));\n  list[i++] = new Sphere(from(4.0, 1.0, 0.0), 1.0, new MetalMaterial(from(0.7, 0.6, 0.5), 0.0));\n  return new HitableList(list);\n};\n\nexport default (({\n  width = 800,\n  height = 400,\n  amount = 2,\n  lookFrom = from(13.0, 2.0, 3.0),\n  lookAt = from(0.0, 0.0, 0.0),\n  vup = from(0.0, 1.0, 0.0),\n  vfov = 20,\n  aspect = _div_(width, height),\n  focusDist = 10,\n  aperture = 0.1\n}) => {\n  let nx = width;\n  let ny = height;\n  let camera = new Camera(lookFrom, lookAt, vup, vfov, aspect, aperture, focusDist);\n  let world = randomScene(amount);\n  return function* () {\n    for (let j = _sub_(ny, 1); j >= 0; j--) {\n      for (let i = 0; i < nx; i++) {\n        let u = _div_(_add_(i, Math.random()), nx);\n\n        let v = _div_(_add_(j, Math.random()), ny);\n\n        let ray = camera.getRay(u, v);\n        let [r, g, b] = color(ray, world);\n        let a = 1;\n        yield r;\n        yield g;\n        yield b;\n        yield a;\n      }\n    }\n  };\n});","import React, { useState, useEffect, useRef } from 'react'\r\nimport createRayTracing from './ray-tracing'\r\n\r\nconst delay = (time = 0) => new Promise(resolve => setTimeout(resolve, time))\r\n\r\nexport default function Demo01() {\r\n  let [count, setCount] = useState(0)\r\n  let [time, setTime] = useState(0)\r\n  let ref = useRef()\r\n  let width = 800\r\n  let height = 400\r\n\r\n  useEffect(() => {\r\n    let canvas = ref.current\r\n    let ctx = canvas.getContext('2d')\r\n    var imageData = ctx.createImageData(width, height)\r\n    let renderImage = createRayTracing({ width, height, amount: 50 })\r\n    let data = []\r\n    let innerCount = 1\r\n    let innerTime = 0\r\n    let tid = null\r\n    let over = false\r\n\r\n    let render = async () => {\r\n      let start = Date.now()\r\n      let i = 0\r\n      let j = 0\r\n      let duration = 0\r\n\r\n      for (let n of renderImage()) {\r\n        if (typeof data[i] !== 'number') data[i] = 0\r\n        data[i] += n\r\n        imageData.data[i] = Math.floor(255.99 * Math.sqrt(data[i] / innerCount))\r\n        i += 1\r\n        j += 1\r\n        duration = Date.now() - start\r\n        setTime(innerTime + duration)\r\n        if (duration % 100 === 0) await delay()\r\n        if (over) return\r\n      }\r\n\r\n      if (over) return\r\n\r\n      ctx.clearRect(0, 0, width, height)\r\n      ctx.putImageData(imageData, 0, 0)\r\n      tid = setTimeout(render, 100)\r\n\r\n      setCount(innerCount)\r\n      setTime((innerTime += Date.now() - start))\r\n\r\n      innerCount += 1\r\n    }\r\n\r\n    render()\r\n\r\n    return () => {\r\n      over = true\r\n      clearTimeout(tid)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <>\r\n      <canvas width={width} height={height} ref={ref} />\r\n      <h3>光线追踪时间：{(time / 1000).toFixed(2)}秒</h3>\r\n      <h3>渲染次数：{count}</h3>\r\n      <h3>平均时间：{(count ? time / 1000 / count : 0).toFixed(2)}秒</h3>\r\n    </>\r\n  )\r\n}\r\n"],"sourceRoot":""}